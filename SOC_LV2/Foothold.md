# Threat Hunting: Foothold  

- Initial Access	
    - Seek patterns of numerous failed login attempts to external services, followed by a successful authentication.
    - Monitor intrusion attempts on web applications and potential code execution on web servers.
    - Look for unusual file downloads and temporary files created by Outlook clients.
    - Correlate all subsequent events after the successful intrusion attempt.
- Execution	
    - Identify excessive usage of cmd.exe and powershell.exe.
    - Spot misused legitimate operating system binaries and scripts (LOLBAS) and correlate their subsequent execution.
    - Look for potential abuse of installed programming tools.
    - Utilise the parent-child relationships of processes to connect associated events.
- Defence Evasion	
    - Look for attempts to disable security software.
    - Keep an eye out for log deletion events.
    - Look for process injection activities.
    - Correlate all evasion activities to their parent process and find subsequent events if the evasion attempt succeeded.
- Persistence	
    - Watch out for the creation of scheduled tasks.
    - Look for suspicious registry modifications on known registries used for persistence.
    - Correlate all persistence activities back to their parent process.
- Command and Control	
    - Look for a high count of unique subdomains on a single domain.
    - Spot unusual outgoing connections to cloud services/applications.
    - Look for an unusual number of outbound connections to an unfamiliar domain.
    - Correlate all unusual activity back to its associated process.

# Inital Access
[Initial Access Tactic (TA0001)](https://attack.mitre.org/tactics/TA0001/)  
The primary objective during this phase is to gain a foothold in the network, which can be achieved through a variety of means, such as:  
- Social Engineering techniques such as phishing.
- Exploiting vulnerabilities through public-facing servers.
- Spraying credentials through exposed authentication endpoints.
- Executing commands through malicious flash drives.
- Installing cracked software with hidden malicious code.  

The common intersection of the given examples above is gaining initial access to either of the following:  
- Account access via a valid credential
- Machine access via a remote code execution  

## Hunting Initial Access
- Brute-forcing attempts via SSH.  
    `filebeat-*`  
    To start hunting, use the Visualize Library from the left sidebar and create a visualisation table using Lens.  
    ```
    host.name: jumphost AND event.category: authentication AND system.auth.ssh.event: Failed
    ```  
    ![a77](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/446eb925-cc47-48b0-a595-0b04d528d44d)  
    Now that we have gathered significant information about brute-force attempts, let's find a successful authentication.  
    ```
    host.name: jumphost AND event.category: authentication AND system.auth.ssh.event: Accepted AND source.ip: (167.71.198.43 OR 218.92.0.115) 
    ```  
- Exploitation of a web application vulnerability.  
    `packetbeat-*`  
    Web application attacks typically start with enumeration attempts and proceed with exploiting discovered vulnerabilities.  
    ```
    host.name: web01 AND network.protocol: http AND destination.port: 80
    ```  
    ![a81](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/b5f482b6-2112-4bd0-8f86-0926b7c7a5e5)  
    Upon checking the results above (highlight #5), it can be observed that the query provided a high count of status code `404`, indicating a directory enumeration attempt by `167.71.198.43` since the attack produces many "Page Not Found" results due to its behaviour of guessing valid endpoints.  
    ```
    host.name: web01 AND network.protocol: http AND destination.port: 80 AND source.ip: 167.71.198.43 AND http.response.status_code: 404
    ```  
    ![b3a](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/a982989a-ace4-45b9-ba2a-1317f56c4976)  
    To continue, let's replace the KQL query with status codes 200, 301, and 302 to focus on valid endpoints accessed by the attacker.  
    ```
    host.name: web01 AND network.protocol: http AND destination.port: 80 AND source.ip: 167.71.198.43 AND http.response.status_code: (200 OR 301 OR 302)
    ```  
- Phishing via links and attachments.  
    `winlogbeat-*`  
    Given this, we will hunt for the following behaviours that satisfy this idea: 
    1. Files downloaded using a web browser.
    2. Files opened from an email client (in this case, we will be hunting files opened from an Outlook client).  
    ### Files Downloaded using Chrome
    We will hunt file creations (Sysmon Event ID 11(File create)) generated by chrome.exe:  
    ```
    host.name: WKSTN-* AND process.name: chrome.exe AND winlog.event_id: 11
    ```  
    ![29](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/efae6371-22f5-4f57-9978-c70c654ba6ef)  
    Note: We can ignore the .tmp files created by Chrome. By default, chrome.exe creates a temporary file when a file is being downloaded.  
    ### Files Opened using Outlook  
    ```
    host.name: WKSTN-* AND process.name: OUTLOOK.EXE AND winlog.event_id: 11
    ```  

# Execution
[Execution Tactic (TA0002)](https://attack.mitre.org/tactics/TA0002/)  
Example techniques used by adversaries are the following:  
- Execution through command-line tools like PowerShell and Windows Command Processor (cmd.exe).
- Execution through built-in system tools or using Living-off-the-land Binaries (LOLBAS).
- Execution through scripting/programming tools, such as Python or PHP.  

|Execution Technique	|Examples|
|:----|----|
|Command-line Tools| Using built-in commands through `powershell.exe` and `cmd.exe` to download and execute the staged payload.|
|Built-in System Tools	| Using `certutil.exe` or `bitsadmin.exe` for downloading the remote payload and `rundll32.exe` to run it.|
|Scripting / Programming Tools	| Using built-in functionalities of programming tools such as Python's `os.system()` or PHP's `exec()`.|  

## Hunting Execution  
- Suspicious usage of command-line tools  
    `winlogbeat-*`  
    To hunt process creations (Sysmon Event ID 1) generated by these two tools:  
    `host.name: WKSTN-* AND winlog.event_id: 1 AND process.name: (cmd.exe OR powershell.exe)`  
    ![63](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/b81fa472-c907-41ef-8cfc-5ae0fdbab0e4)  

    To add on PowerShell analysis, an alternative way to hunt unusual PowerShell execution is through the events generated by `PowerShell's Script Block` Logging.  
    ```
    host.name: WKSTN-* AND winlog.event_id: 4104
    ```  
    Some examples of PowerShell strings are provided below:  
    - invoke / invoke-expression / iex
    - -enc / -encoded
    - -noprofile / -nop
    - bypass
    - -c / -command
    - -executionpolicy / -ep
    - WebRequest
    - Download  
- Abuse of built-in system tools.  
    `winlogbeat-*`   
    To hunt process creation (Sysmon Event ID 1) as well as network connection (Sysmon Event ID 3) events:  
    ```
    host.name: WKSTN-* AND winlog.event_id: (1 OR 3) AND (process.name: (mshta.exe OR certutil.exe OR regsvr32.exe) OR process.parent.name: (mshta.exe OR certutil.exe OR regsvr32.exe))
    ```  
    ![33](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/42d3c16b-cbf1-4803-a3d7-ecf9e98cb286)  

    Next step:  
    - Identify the extent of these malicious activities by correlating the subsequent events generated after these LOLBAS were used.  
    - One example is getting the process ID of the child processes spawned by these LOLBAS and investigating them further.  

- Execution via programming/scripting tools.  
    `winlogbeat-*` 
    ```
    host.name: WKSTN-* AND winlog.event_id: (1 OR 3) AND (process.name: (*python* OR *php* OR *nodejs*) OR process.parent.name: (*python* OR *php* OR *nodejs*))
    ```  
    ![6c](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/6ae9a825-2e5f-427e-a9fe-ab710cf44ec1)  

    Using these findings, we can extend our investigation further by getting the process ID of the cmd.exe process spawned by Python and using it in our new KQL query.  
    Using this process PID, we can search all processes spawned by this cmd.exe instance by using it as our `process.parent.pid`:  
    ```
    host.name: WKSTN-* AND winlog.event_id: (1 OR 3) AND process.parent.pid: 1832
    ```  

    Next step:  
    - identify the extent of these malicious activities by correlating the subsequent events generated after the execution of the suspicious Python script.  

# Defense Evasion
[Defense Evasion Tactic (TA0005)](https://attack.mitre.org/tactics/TA0005/)  
- Disabling security software.
- Deleting attack footprints on logs.
- Deceiving analysts through masquerading, obfuscation, and encryption. 
- Executing known bypasses to security controls.  

|Evasion Technique|Examples|
|:----|:----|
|Disabling security software|Disabling Windows Defender via the command line or reverting the updated detection signatures.|
|Deleting logs|Deleting all existing Windows Event Logs inside the compromised machine.|
|Deceiving analysts|Mimicking process names or spoofing parent process IDs.|
|Executing known bypasses|Using known vulnerabilities or modifying host configurations to bypass the controls.|  

## Hunting Defense Evasion
- Disabling security software.  
    `winlogbeat-*`  
    For this example, we will focus on known commands used to disable Windows Defender.  
    ```
    host.name: WKSTN-* AND (*DisableRealtimeMonitoring* OR *RemoveDefinitions*)
    ```  
    - DisableRealtimeMonitoring - Commonly used with PowerShell's `Set-MPPreference` to disable its real-time monitoring.
    - RemoveDefinitions - Commonly used with built-in `MpCmdRun.exe` to remove all existing signatures of Windows Defender.  
    ![3b429919f44e0d05a028d2d8f0494b66](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/e7b4f7eb-64ab-454d-b197-3aef35ca104e)  
- Log deletion attempts.  
    The simplest way to detect the deletion of Windows Event Logs is via Event ID `1102`.  
    ```
    host.name: WKSTN-* AND winlog.event_id: 1102
    ```  
    The next step of this investigation is to identify the log source that was removed and the command used to delete the logs. To complete the investigation, use `View surrounding documents` to see the command used to clear the event logs.  
    ![d3](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/b7e0696f-924a-43da-aeb8-2e1966887547)  
- Executing shellcode through process injection.  
    We will use Sysmon's capability to detect CreateRemoteThread and hunt for potential process injection. Sysmon's Event ID `8` (CreateRemoteThread), which detects when a process creates a thread in another process.  
    ```
    host.name: WKSTN-* AND winlog.event_id: 8
    ```  
    ![77c](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/411d6d22-8f11-4f97-bdb5-239b0bd01fb9)  
    Based on the results, the entry of `C:\Users\clifford.miller\Downloads\chrome.exe` created a new thread on `explorer.exe`, which is a typical target process threat actors use for process injection techniques. In addition, most entries are executed by a SYSTEM account, except for the chrome.exe, which is being run by Clifford Miller's account. 

# Persistence
[Persistence Tactic (TA0003)](https://attack.mitre.org/tactics/TA0003/)  
- Modification of registry keys to hijack the typical system/program startup.
- Installation of malicious scripts or software that automatically starts.
- Creation of additional high-privileged backdoor accounts.  

|Persistence Technique|Examples|
|:----|:----|
|Modification of registry keys|Using `reg.exe` to modify registry keys related to system boot-up, such as Run or RunOnce keys.|
|Installation of auto-start scripts|Creation of scheduled tasks (via `schtasks.exe`) to regularly update and execute the implanted malware.|
|Creation of additional accounts|Using `net.exe` to create a new user and add it to the local administrators' group.|  

## Hunting Persistence
- Scheduled Task creation.  
    `winlogbeat-*`  
    If Windows Advanced Audit Policy is properly configured, we can use Event ID `4698` (Scheduled Task Creation). Else, we can use the following keywords for hunting commands related to scheduled tasks: `schtasks and Register-ScheduledTask (PowerShell)`  
    ```
    host.name: WKSTN-* AND (winlog.event_id: 4698 OR (*schtasks* OR *Register-ScheduledTask*))
    ```  
    ![f5](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/2e0c8531-2440-4f69-9ec3-c899f198e449)  
    
- Registry key modification.  
    `winlogbeat-*`  
    Given that the operating system commonly uses it, events generated by monitoring registry modifications are overwhelming and differentiating benign activity from malicious ones might be tedious.  
    ```
    host.name: WKSTN-* AND winlog.event_id: 13 AND winlog.channel: Microsoft-Windows-Sysmon/Operational
    ```  
    To ease the way of hunting, we can focus on known registry keys abused by threat actors to reduce the results:
    - Software\Microsoft\Windows\CurrentVersion\Explorer\Shell (User Shell Folders)
    - Software\Microsoft\Windows\CurrentVersion\Run (RunOnce)  
    ```
    host.name: WKSTN-* AND winlog.event_id: 13 AND winlog.channel: Microsoft-Windows-Sysmon/Operational AND registry.path: (*CurrentVersion\\Run* OR *CurrentVersion\\Explorer\\User* OR *CurrentVersion\\Explorer\\Shell*)
    ```  
    ![4a](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/264ee2f3-a3f0-46d6-b1ab-e2eaf5365f67)  
    An alternative way of hunting unusual registry modifications is through process filtering.   
    ```
    host.name: WKSTN-* AND winlog.event_id: 13 AND winlog.channel: Microsoft-Windows-Sysmon/Operational AND process.name: (reg.exe OR powershell.exe)
    ```  
    ![cb](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/b0a048f9-c3a6-417c-b0c6-3b18e9b274ac)  
    
# Command and Control  
[Command and Control Tactic (TA0011)](https://attack.mitre.org/tactics/TA0011/)  
- Standard network protocols, such as DNS, ICMP, HTTP/s.  
- Known cloud-based services.  
- Encrypted custom HTTP/s server.  

|Command and Control Technique|Examples|
|:----|:------|
|Standard network protocols|Using the DNS protocol as a communication channel via its subdomain.|
|Known cloud-based services|Passing traffic through known web applications such as Google Drive, Telegram and Discord.|
|Encrypted custom HTTP/s server	|Using a self-hosted server with a well-groomed domain passing encrypted traffic.|

## Hunting Command and Control  
- Command and Control over DNS  
    `packetbeat-*` `winlogbeat-*`  
    In this technique, adversaries can disguise their C2 communications as typical DNS queries and responses, bypassing network security measures.  
    - High count of unique subdomains  
    - Unusual DNS requests based on query types (MX, CNAME, TXT)  
    To start hunting, use the Visualize Library again and create a visualisation table using Lens. Ensure that the table is configured with the following:  
    - Set the Table Index (packetbeat), Rows (dns.question.registered_domain and host.name), and Metrics (Unique Count of dns.question.subdomain).  
    - Use the KQL query to list all DNS queries and exclude all reverse DNS lookups:  
    ```
    network.protocol: dns AND NOT dns.question.name: *arpa
    ```  
    ![865a9751c4a18147548b8cff01ab6a9a](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/94b16090-a702-401d-b81d-43711199a5b7)  

    Let's use the following KQL query in the Discover tab on `packetbeat-*` index:  

    ```
    network.protocol: dns AND NOT dns.question.name: *arpa AND dns.question.registered_domain: golge.xyz AND host.name: WKSTN-1
    ```  
    We can also add the `query` field as a column to see its values.  
    ![8e39190bffa7de54fd56bc460a592b4a](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/e211a654-4896-434c-9bf2-f4312ee0ed8b)  
    ![f603f27024a4c2851fc5f93fde63826f](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/e3e374e2-11ba-4830-ae07-599233e27f5d)  

     we can correlate this activity on `winlogbeat-*` to identify the process executing the DNS requests using the following KQL query:  
     ```
     host.name: WKSTN-1* AND destination.ip: 167.71.198.43 AND destination.port: 53
     ```  
     ![802fcf147063697602bc7fad5ac2e5ae](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/a8dff3e0-9534-4147-9a1f-1440d977ba05)  

     Based on the results, it can be observed that all connections to 167[.]71[.]198[.]43:53 are generated by nslookup.exe. To continue the event correlation, let's use View surrounding documents to see the subsequent events related to this activity.  
     ![85da84331a98a93fc99a29c7fc8f606a](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/fd86a7be-7a84-4a09-aaa3-ac695e5b2abf)  

- Command and Control over Cloud Apps  
    `packetbeat-*` `winlogbeat-*`  
    To start hunting, we will use the same visualisation table of C2 over DNS. However, we will remove the unique subdomain metric and sort the count in ascending order. With this setup, we can see cloud application domains that workstations do not commonly access.  
    ![d36f34dcc5077e39c9ebc2f47408d5fe](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/7f3d8a13-ebe6-442d-a7dd-d8c788e35d1d)  

    Upon seeing the results, `discord.gg`, a known cloud application, is being used by `WKSTN-1`. Threat actors are using this application to host their C2 traffic. We can use this as a lead to investigate its unusual usage. With this information, we can pivot to `winlogbeat-*` index to correlate the associated process and use the following KQL query:  
    ```
    host.name: WKSTN-1* AND *discord.gg*
    ```  
    ![b645a11f38ee71500d8db738fd313287](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/72ed3406-e2f3-48c1-955b-77087e95824f)  

    Based on the results, it can be seen that the connections going to Discord are initiated by `C:\Windows\Temp\installer.exe`. We can investigate further by hunting all processes spawned by this process using the following KQL query: 
    ```
    host.name: WKSTN-1* AND winlog.event_id: 1 AND process.parent.executable: "C:\\Windows\\Temp\\installer.exe"
    ```  
    ![54a2a40ceae8f7e0646bf0233c2ea8b6](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/9fae354b-d7dc-497c-a625-1d69b0f77430)  

- Command and Control over Encrypted HTTP Traffic  
    `packetbeat-*` `winlogbeat-*`  
    Compared to the first two C2 techniques, C2 over Encrypted HTTP traffic is just a typical command and control type. The main notable thing about this technique is that attackers use their own C2 domain, including custom traffic encryption over HTTP. Given this, we will hunt for unusual HTTP traffic based on the following:
    - High count of HTTP traffic to distinctive domains  
    - High outbound HTTP bandwidth to unique domains  
    To start hunting, use the Visualize Library again and create a visualisation table using Lens. Ensure that the table is configured with the following:  
    - Set the Table Index (packetbeat), Rows (host.name, destination.domain, http.request.method), and Metrics (count).  
    - Use the KQL query to list all outbound HTTP requests:  
    ```
    network.protocol: http AND network.direction: egress  
    ```  
    ![2e5532368e2226e225401380bb69a597](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/70f7c586-c0a3-4c25-af2f-954e9981b893)  

    Based on the results, it is highly notable that HTTP connections to cdn[.]golge[.]xyz from both workstations are numerous. This may indicate that a continuous C2 connection has been running for an extended time. We can modify the Lens table and focus the query to cdn[.]golge[.]xyz using this KQL query to understand better:  
    ```
    host.name: WKSTN-* AND network.protocol: http AND network.direction: egress AND destination.domain: cdn.golge.xyz
    ```  
    In addition, we can modify the rows and focus only on `host.name` and `query` fields.  
    ![f1a1675f4d83698f52696047561fa1e9](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/42ebb06e-a639-4df3-ae43-5b3c9cad8574)  

    Using the following KQL query provided us with some insights regarding the associated process:  
    ```
    host.name: WKSTN-* AND *cdn.golge.xyz*
    ```  
    ![8fb64e55f142870cc480d204f4a10998](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/92918d76-9ac1-4056-b0f2-229c018ada04)  

# Pivoting  
# Discovery  
[Discovery Tactic (TA0007)](https://attack.mitre.org/tactics/TA0007/)  
|Discovery Technique|Examples|
|:----|:------|
|User Reconnaissance|Using built-in commands like `whoami`. `net user`. `net localgroup` or `qwinsta` for account enumeration and dir or ls for file and folder enumeration.|
|Host Reconnaissance|Commands such as `hostname`, `wmic`, `ipconfig` or `systeminfo` for gathering host information, `net start` or `sc.exe query` for service enumeration, and simply navigating through GUI-based applications like Windows Security to determine the security controls running in the compromised host.|
|Internal Scanning|Displaying arp table (via `arp` command), sweeping reachable assets via `ping`, and scanning open ports using different tools, such as Nmap or PowerShell (leveraging built-in capabilities).|
|Internal Domain Reconnaissance	|Using built-in commands like `net * /domain` or `nltest /dclist` or loading known PowerShell commands and scripts to list domain users (PowerView or BloodHound) to enumerate domain objects.|

## Hunting Discovery  
- Host Reconnaissance  
    `winlogbeat-*`  
    Using the Discover tab, we will focus on the following command-line tools:  
    `whoami.exe` `hostname.exe` `net.exe` `systeminfo.exe` `ipconfig.exe` `netstat.exe` `tasklist.exe`  
    ```
    winlog.event_id: 1 AND process.name: (whoami.exe OR hostname.exe OR net.exe OR systeminfo.exe OR ipconfig.exe OR netstat.exe OR tasklist.exe)
    ```  
    ![e726a90eecb5c092ba657f5ce05a0557](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/562c3ab8-cb6b-4502-8710-2f4db9e77232)  
    Based on the results, it can be seen that bill.hawkins has executed multiple enumeration tools on WKSTN-2. Moreover, all commands were spawned by `cmd.exe`. On a quick look, this might not indicate any unusual activities since System Administrators typically do remote login and spawn Windows Command Processor to execute troubleshooting and host identification commands. Let's continue the investigation by diving deeper into the `cmd.exe` process.  

    To do this, we can get the `parent process ID` of these logs to get the process identifier of the unusual `cmd.exe` process. Click the drop-down button of the first execution of the `whoami /priv` command and find the `process.parent.pid`.  
    
    Next step:  
    - Identify the extent of the attack by checking the child processes spawned by the malicious PowerShell process.  
    - How the execution of PowerShell started.  

- Internal Network Scanning  
    `packetbeat-*` `winlogbeat-*`  
    To start hunting, use the Visualize Library and create a visualisation table using Lens.  
    - Set the Table Index (packetbeat), Rows (host.name, source.ip and destination.ip), and Metrics (Unique count of destination.port).  
    - Use the KQL query below to view all internal network connections to well-known ports:  
    ```
    source.ip: 10.0.0.0/8 AND destination.ip: 10.0.0.0/8 AND destination.port < 1024
    ```  
    ![8855123c7257c05b7d0fd5ebf57d7770](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/1be3c988-cdce-4a2b-8ef3-c6bab0aaf452)  
    Upon checking the results above (highlight #4), it can be observed that the table provided the workstations indicating a potential port scanning activity. These two hosts (`INTSRV01` AND `WKSTN-2`) are highly notable since they generated connections to 1023 unique destination ports.  

    ```
    winlog.event_id: 3 AND source.ip: 10.10.184.105 AND destination.ip: 10.10.122.219 AND destination.port < 1024
    ```  
    ![e5bbdf92202ee58aa4c9ae0fc846563a](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/5efff788-5b50-4035-ae64-8cdda4a53737)  
    Using `Sysmon Event ID 3 (Network Connection)`, we were able to correlate the potential port scanning activity to a process named `n.exe`. Moreover, it can be concluded that the originating host is from `WKSTN-2` and the target is `INTSRV01`. This activity seems suspicious since all these connections were initiated by a user account, not a system or service account.  
    ***Note: Only successful connections established are logged by Sysmon Event ID 3, meaning all these ports logged were identified as open.***  

    Next step:  
    - Identify the events generated by n.exe and its parent process.  

- Active Directory Enumeration  
    `winlogbeat-*`  
    Domain Enumeration typically generates many LDAP queries. We will focus on hunting processes that initiated an LDAP network connection (port 389 for LDAP and port 636 for LDAP over SSL). Using Sysmon Event ID 3:  
    ```
    winlog.event_id: 3 AND source.ip: 10.0.0.0/8 AND destination.ip: 10.0.0.0/8 AND destination.port: (389 OR 636) AND NOT process.name: mmc.exe
    ```  
    ***Note: We have excluded mmc.exe from the query since this process typically generates benign LDAP connections. ***  
    ![c7f5dfc2ec94bf900c23b106155e4632](https://github.com/nkn-ctrl/TryHackMe/assets/73976100/fba0bc64-f477-4328-b75a-4f9f851ba34b)  
    Based on the results, three processes initiated an LDAP connection, one of which is a highly notable binary - `SharpHound.exe`. This binary is a well-known tool primarily used for reconnaissance and data collection within Active Directory (AD) environments.  

    Next step:  
    - Identify the subsequent actions made after the execution of SharpHound.

# Privilege Escalation  
[Privilege Escalation Tactic (TA0004)](https://attack.mitre.org/tactics/TA0004/)  
|Privilege Escalation Technique|Examples|
|:----------|:-----------|
|Exploitation of vulnerabilities|Using known userland and kernel exploits on unpatched hosts.|
|Usage of valid accounts|Using runas commands with newly-discovered credentials or re-authenticating with a privileged account in the same machine.|
|Access control abuse|Abusing overly permissive Access Control Lists (ACLs), allowing other accounts to grant or acquire additional permissions.|
|Host misconfiguration abuse|Abusing insecure service configurations, such as modifiable and restartable services or overwritable service binaries.|



































    
